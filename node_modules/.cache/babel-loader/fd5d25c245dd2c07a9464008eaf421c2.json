{"ast":null,"code":"import { Tree, utils } from 'phylocanvas';\nconst {\n  getPixelRatio\n} = utils.canvas;\nconst DEFAULTS = {\n  active: true\n};\n\nfunction addListeners() {\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const textSize = this.textSize * this.zoom / 2;\n\n  if (this.treeStats.active) {\n    function respond(e) {\n      let path = new Path2D();\n      let x = (thing.offsetx + leaf.maxx * thing.zoom / 2) * pixelRatio;\n      let y = (thing.offsety + leaf.maxy * thing.zoom / 2) * pixelRatio;\n      path.moveTo(x, y);\n      path.lineTo(x + 600, y);\n      path.lineTo(x + 600, y + 30);\n      path.lineTo(x, y + 30);\n      path.lineTo(x, y);\n      path.closePath();\n      cxt.stroke(path);\n\n      if (cxt.isPointInPath(path, e.offsetX, e.offsetY)) {}\n    }\n\n    for (let eventListener of this.eventListeners.mousemove.filter(eventListener => eventListener.listener.name == \"respond\")) {\n      console.log(eventListener);\n      this.removeListener('mousemove', respond, canvas);\n    }\n\n    console.log(this);\n\n    for (let leaf of this.leaves) {\n      this.removeListener('mousemove', respond, canvas);\n      this.addListener('mousemove', respond, canvas);\n      let thing = this;\n    }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [, config = {}] = args;\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    delegate.apply(this, args);\n    addListeners.apply(this);\n  });\n}","map":{"version":3,"sources":["/var/www/pathogen-intelligence.tgen.org/epitools/my_modules/phylocanvas-plugin-tree-stats/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","addListeners","cxt","pixelRatio","textSize","zoom","treeStats","respond","e","path","Path2D","x","thing","offsetx","leaf","maxx","y","offsety","maxy","moveTo","lineTo","closePath","stroke","isPointInPath","offsetX","offsetY","eventListener","eventListeners","mousemove","filter","listener","name","console","log","removeListener","leaves","addListener","plugin","decorate","delegate","args","tree","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n};\n\nfunction addListeners() {\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const textSize = this.textSize * this.zoom / 2 \n  if (this.treeStats.active) {\n         function respond(e) {\n          let path = new Path2D()\n          let x = (thing.offsetx + leaf.maxx * thing.zoom / 2) * pixelRatio\n          let y = (thing.offsety + leaf.maxy * thing.zoom / 2) * pixelRatio\n          path.moveTo(x, y)\n          path.lineTo(x + 600, y)\n          path.lineTo(x + 600, y + 30)\n          path.lineTo(x, y + 30)\n          path.lineTo(x, y)\n          path.closePath()\n          cxt.stroke(path)\n          if (cxt.isPointInPath(path, e.offsetX, e.offsetY)) {\n          }\n        }\n     for (let eventListener of this.eventListeners.mousemove.filter(eventListener => eventListener.listener.name == \"respond\")) {\n        console.log(eventListener)\n        this.removeListener('mousemove', respond, canvas)\n      }\n      console.log(this)\n      for (let leaf of this.leaves) {\n        this.removeListener('mousemove', respond, canvas)\n        this.addListener('mousemove', respond, canvas)\n        let thing = this\n      }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    delegate.apply(this, args);\n    addListeners.apply(this)\n  });\n}\n"]},"metadata":{},"sourceType":"module"}