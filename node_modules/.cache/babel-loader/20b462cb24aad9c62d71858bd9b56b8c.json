{"ast":null,"code":"import { Tree, utils } from 'phylocanvas';\nconst {\n  getPixelRatio\n} = utils.canvas;\nconst DEFAULTS = {\n  active: true,\n  width: 100,\n  height: 20,\n  fillStyle: 'black',\n  strokeStyle: 'black',\n  lineWidth: 1,\n  fontFamily: 'Sans-serif',\n  fontSize: 16,\n  textBaseline: 'bottom',\n  textAlign: 'center',\n  digits: 2,\n  position: {\n    bottom: 10,\n    left: 10\n  }\n};\n\nfunction drawBranchLength() {\n  const {\n    branchLength,\n    zoom,\n    branchScalar\n  } = this;\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const lineWidth = pixelRatio * branchLength.lineWidth;\n  const fontSize = pixelRatio * branchLength.fontSize;\n  const pi = 3.141592653589793;\n  cxt.save(); //console.log(this)\n\n  console.log(this.branches); //console.log(this.offsetx, this.offsety)\n\n  cxt.font = `${this.textSize}px ${branchLength.fontFamily}`;\n  cxt.fillStyle = branchLength.fillStyle;\n  cxt.strokeStyle = branchLength.strokeStyle;\n  cxt.lineWidth = lineWidth;\n  cxt.textBaseline = branchLength.textBaseline;\n  cxt.textAlign = branchLength.textAlign;\n\n  for (let branch in this.branches) {\n    branch = this.branches[branch];\n\n    if (branch.branchLength == 0) {\n      continue;\n    }\n\n    let x = (this.offsetx + (branch.startx + (branch.centerx - branch.startx) / 2) * this.zoom / 2) * pixelRatio;\n    let y = (this.offsety + (branch.starty + (branch.centery - branch.starty) / 2) * this.zoom / 2) * pixelRatio;\n\n    if (this.treeType == \"rectangular\") {\n      y = (this.offsety + branch.centery * this.zoom / 2) * pixelRatio;\n    } else if (pi * 1 / 4 < branch.angle && branch.angle < pi * 3 / 4 || pi + pi * 1 / 4 < branch.angle && branch.angle < pi + pi * 3 / 4) {\n      x = (this.offsetx + branchLength.fontSize + branch.centerx * this.zoom / 2) * pixelRatio;\n      y += branchLength.fontSize;\n    }\n\n    cxt.fillText(branch.branchLength, x, y);\n  }\n\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [, config = {}] = args;\n    tree.branchLength = Object.assign({}, DEFAULTS, config.branchLength || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n\n    if (this.branchLength.active) {\n      drawBranchLength.apply(this);\n    }\n  });\n}","map":{"version":3,"sources":["/var/www/epitools/my_modules/phylocanvas-plugin-branch-length/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","width","height","fillStyle","strokeStyle","lineWidth","fontFamily","fontSize","textBaseline","textAlign","digits","position","bottom","left","drawBranchLength","branchLength","zoom","branchScalar","cxt","pixelRatio","pi","save","console","log","branches","font","textSize","branch","x","offsetx","startx","centerx","y","offsety","starty","centery","treeType","angle","fillText","restore","plugin","decorate","delegate","args","tree","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n  width: 100,\n  height: 20,\n  fillStyle: 'black',\n  strokeStyle: 'black',\n  lineWidth: 1,\n  fontFamily: 'Sans-serif',\n  fontSize: 16,\n  textBaseline: 'bottom',\n  textAlign: 'center',\n  digits: 2,\n  position: {\n    bottom: 10,\n    left: 10,\n  },\n};\n\nfunction drawBranchLength() {\n\n  const { branchLength, zoom, branchScalar } = this;\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const lineWidth = pixelRatio * branchLength.lineWidth;\n  const fontSize = pixelRatio * branchLength.fontSize;\n  const pi = 3.141592653589793\n\n  cxt.save();\n\n  //console.log(this)\n  console.log(this.branches)\n  //console.log(this.offsetx, this.offsety)\n\n  cxt.font = `${this.textSize}px ${branchLength.fontFamily}`;\n  cxt.fillStyle = branchLength.fillStyle;\n  cxt.strokeStyle = branchLength.strokeStyle;\n  cxt.lineWidth = lineWidth;\n  cxt.textBaseline = branchLength.textBaseline;\n  cxt.textAlign = branchLength.textAlign;\n\n  for (let branch in this.branches) {\n    branch = this.branches[branch]\n    if (branch.branchLength == 0) {\n      continue\n    }\n    let x = (this.offsetx + (branch.startx + (branch.centerx - branch.startx) / 2) * this.zoom / 2) * pixelRatio\n    let y = (this.offsety + (branch.starty + (branch.centery - branch.starty) / 2) * this.zoom / 2) * pixelRatio\n    if (this.treeType == \"rectangular\") {\n      y = (this.offsety + branch.centery * this.zoom / 2) * pixelRatio\n    } else if (pi * 1 / 4 < branch.angle && branch.angle < pi * 3 / 4 || pi + pi * 1 / 4 < branch.angle && branch.angle < pi + pi * 3 / 4) {\n      x = (this.offsetx + branchLength.fontSize + branch.centerx * this.zoom / 2) * pixelRatio\n      y += branchLength.fontSize\n    }\n    cxt.fillText(branch.branchLength, x, y)\n  }\n\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.branchLength = Object.assign({}, DEFAULTS, config.branchLength || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n    if (this.branchLength.active) {\n      drawBranchLength.apply(this);\n    }\n  });\n}\n"]},"metadata":{},"sourceType":"module"}