{"ast":null,"code":"import _slicedToArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createForOfIteratorHelper from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport { Tree, utils } from 'phylocanvas';\nvar getPixelRatio = utils.canvas.getPixelRatio;\nvar DEFAULTS = {\n  active: true,\n  debug: false,\n  margin: 20,\n  fontFamily: \"Sans-serif\",\n  fontSize: 30,\n  textBaseLine: \"top\",\n  textAlign: \"left\"\n};\n\nfunction addListeners() {\n  var _this = this;\n\n  var tree = this;\n  var ctx = this.canvas;\n  var canvas = ctx.canvas;\n  var pixelRatio = getPixelRatio(ctx);\n  var treeStats = this.treeStats,\n      textSize = this.textSize;\n\n  if (this.treeStats.active) {\n    //cleanup old event listeners\n    var _iterator = _createForOfIteratorHelper(this.eventListeners.mousemove.filter(function (eventListener) {\n      return eventListener.listener.name == \"treeStatsListener\";\n    })),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var eventListener = _step.value;\n        this.removeListener('mousemove', eventListener.listener, canvas);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    console.log(this);\n\n    var _iterator2 = _createForOfIteratorHelper(this.leaves),\n        _step2;\n\n    try {\n      var _loop = function _loop() {\n        var leaf = _step2.value;\n        //==================================================( DEMO: replace this code with getting per node treeStats )\n        var windowText = [leaf.id];\n\n        for (var i = 0; i < Math.max(Math.ceil(Math.random() * 3), 1); i++) {\n          var rand = Math.random();\n          rand = rand.toFixed(Math.ceil(Math.random() * String(rand).length));\n          windowText.push(String(rand));\n        } //==================================================( END DEMO )\n\n\n        _this.addListener('mousemove', treeStatsListener, canvas);\n\n        function treeStatsListener(e) {\n          var path = new Path2D();\n          ctx.save();\n          ctx.font = \"\".concat(tree.textSize * 4, \"px \").concat(tree.font);\n          var lineLength = ctx.measureText(leaf.label).width * tree.zoom / tree.zoomFactor;\n          var lineWidth = ctx.measureText(\"M\").width * tree.zoom / tree.zoomFactor; // get X and Y values\n\n          var centerX = (tree.offsetx + (leaf.minx + leaf.maxx) * tree.zoom / pixelRatio / 2) * pixelRatio;\n          var centerY = (tree.offsety + (leaf.miny + leaf.maxy) * tree.zoom / pixelRatio / 2) * pixelRatio;\n          var startX = centerX - tree.baseNodeSize * tree.zoom * Math.cos(leaf.angle);\n          var startY = centerY - tree.baseNodeSize * tree.zoom * Math.sin(leaf.angle);\n          var endX = centerX + (-tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom + lineLength) * Math.cos(leaf.angle);\n          var endY = centerY + (-tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom + lineLength) * Math.sin(leaf.angle); // stroke line for mouseover detection\n\n          if (tree.treeStats.debug) {\n            ctx.strokeStyle = \"rgba(0, 0, 255, 1)\";\n          } else {\n            ctx.strokeStyle = \"rgba(0, 0, 255, 0)\";\n          }\n\n          ctx.lineWidth = lineWidth;\n          path.moveTo(centerX, centerY);\n          path.lineTo(endX, endY);\n          path.closePath();\n          ctx.stroke(path); // draw treeStats window\n\n          if (ctx.isPointInStroke(path, e.offsetX * pixelRatio, e.offsetY * pixelRatio)) {\n            leaf.highlighted = true;\n            var x = e.offsetX * pixelRatio;\n            var y = e.offsetY * pixelRatio;\n            ctx.save();\n            ctx.font = \"\".concat(treeStats.fontSize * pixelRatio / 2, \"px \").concat(treeStats.fontFamily);\n            ctx.textBaseline = treeStats.textBaseLine;\n            ctx.textAlign = treeStats.textAlign;\n            var boxWidth = 0;\n\n            var _iterator3 = _createForOfIteratorHelper(windowText),\n                _step3;\n\n            try {\n              for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {\n                var text = _step3.value;\n                boxWidth = Math.max(boxWidth, ctx.measureText(text).width + treeStats.margin * 2);\n              }\n            } catch (err) {\n              _iterator3.e(err);\n            } finally {\n              _iterator3.f();\n            }\n\n            var lineHeight = ctx.measureText(\"w\").width + treeStats.margin / 2;\n            var boxHeight = lineHeight * windowText.length + treeStats.margin * 2; // fill box\n\n            if (x + boxWidth > canvas.width) {\n              x -= boxWidth;\n            }\n\n            if (y + boxHeight > canvas.height) {\n              y -= boxHeight;\n            }\n\n            ctx.fillStyle = \"rgba(240, 240, 240, 0.9)\";\n            ctx.fillRect(x, y, boxWidth, boxHeight); // fill text\n\n            ctx.fillStyle = \"rgb(0, 0, 0)\";\n\n            for (var _i = 0; _i < windowText.length; _i++) {\n              ctx.fillText(windowText[_i], x + treeStats.margin, y + treeStats.margin + _i * lineHeight);\n            }\n\n            ctx.restore();\n          } else {\n            leaf.highlighted = false;\n          }\n\n          ctx.restore();\n        }\n      };\n\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        _loop();\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', function (delegate, args) {\n    var tree = delegate.apply(void 0, _toConsumableArray(args));\n\n    var _args = _slicedToArray(args, 2),\n        _args$ = _args[1],\n        config = _args$ === void 0 ? {} : _args$;\n\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    var _this2 = this;\n\n    delegate.apply(this, args);\n    addListeners.apply(this);\n    var ctx = this.canvas;\n    this.addListener('mousemove', function (e) {\n      if (_this2.treeStats.debug) {\n        var path = new Path2D();\n        path.moveTo(0, 0);\n        path.lineTo(e.offsetX * getPixelRatio(ctx), e.offsetY * getPixelRatio(ctx));\n        path.closePath();\n        ctx.stroke(path);\n      }\n    });\n  });\n}","map":{"version":3,"sources":["/var/www/pathogen-intelligence.tgen.org/epitools/my_modules/phylocanvas-plugin-tree-stats/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","debug","margin","fontFamily","fontSize","textBaseLine","textAlign","addListeners","tree","ctx","pixelRatio","treeStats","textSize","eventListeners","mousemove","filter","eventListener","listener","name","removeListener","console","log","leaves","leaf","windowText","id","i","Math","max","ceil","random","rand","toFixed","String","length","push","addListener","treeStatsListener","e","path","Path2D","save","font","lineLength","measureText","label","width","zoom","zoomFactor","lineWidth","centerX","offsetx","minx","maxx","centerY","offsety","miny","maxy","startX","baseNodeSize","cos","angle","startY","sin","endX","getLabelStartX","endY","strokeStyle","moveTo","lineTo","closePath","stroke","isPointInStroke","offsetX","offsetY","highlighted","x","y","textBaseline","boxWidth","text","lineHeight","boxHeight","height","fillStyle","fillRect","fillText","restore","plugin","decorate","delegate","args","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n  debug: false,\n  margin: 20,\n  fontFamily: \"Sans-serif\",\n  fontSize: 30,\n  textBaseLine: \"top\",\n  textAlign: \"left\",\n};\n\nfunction addListeners() {\n  const tree = this\n  const ctx = this.canvas;\n  const canvas = ctx.canvas;\n  const pixelRatio = getPixelRatio(ctx);\n  const { treeStats, textSize } = this\n  if (this.treeStats.active) {\n      //cleanup old event listeners\n      for (let eventListener of this.eventListeners.mousemove.filter(eventListener => eventListener.listener.name == \"treeStatsListener\")) {\n        this.removeListener('mousemove', eventListener.listener, canvas)\n      }\n      console.log(this)\n      for (let leaf of this.leaves) {\n\n        //==================================================( DEMO: replace this code with getting per node treeStats )\n        let windowText = [leaf.id]\n        for (let i = 0; i < Math.max(Math.ceil(Math.random() * 3), 1); i++) {\n          let rand = Math.random()\n          rand = rand.toFixed(Math.ceil(Math.random() * String(rand).length))\n          windowText.push(String(rand))\n        }\n        //==================================================( END DEMO )\n\n        this.addListener('mousemove', treeStatsListener, canvas)\n        function treeStatsListener(e) {\n          let path = new Path2D()\n          ctx.save()\n          ctx.font = `${tree.textSize * 4}px ${tree.font}`;\n          let lineLength = ctx.measureText(leaf.label).width * tree.zoom / tree.zoomFactor\n          let lineWidth = ctx.measureText(\"M\").width * tree.zoom / tree.zoomFactor\n\n          // get X and Y values\n          let centerX = (tree.offsetx + (leaf.minx + leaf.maxx) * tree.zoom / pixelRatio / 2) * pixelRatio\n          let centerY = (tree.offsety + (leaf.miny + leaf.maxy) * tree.zoom / pixelRatio / 2) * pixelRatio\n          let startX = centerX - (tree.baseNodeSize * tree.zoom * Math.cos(leaf.angle))\n          let startY = centerY - (tree.baseNodeSize * tree.zoom * Math.sin(leaf.angle))\n          let endX = centerX + ((-tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom + lineLength) * Math.cos(leaf.angle))\n          let endY = centerY + ((-tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom + lineLength) * Math.sin(leaf.angle))\n\n          // stroke line for mouseover detection\n          if (tree.treeStats.debug) {\n            ctx.strokeStyle = \"rgba(0, 0, 255, 1)\"\n          } else {\n            ctx.strokeStyle = \"rgba(0, 0, 255, 0)\"\n          }\n          ctx.lineWidth = lineWidth\n          path.moveTo(centerX, centerY)\n          path.lineTo(endX, endY)\n          path.closePath()\n          ctx.stroke(path)\n\n          // draw treeStats window\n          if (ctx.isPointInStroke(path, e.offsetX * pixelRatio, e.offsetY * pixelRatio)) {\n            leaf.highlighted = true\n            let x = e.offsetX * pixelRatio\n            let y = e.offsetY * pixelRatio\n            ctx.save()\n            ctx.font = `${treeStats.fontSize * pixelRatio / 2}px ${treeStats.fontFamily}`;\n            ctx.textBaseline = treeStats.textBaseLine\n            ctx.textAlign = treeStats.textAlign\n\n            let boxWidth = 0\n            for (let text of windowText) {\n              boxWidth = Math.max(boxWidth, ctx.measureText(text).width + treeStats.margin * 2)\n            }\n            let lineHeight = ctx.measureText(\"w\").width + treeStats.margin / 2\n            let boxHeight = lineHeight * windowText.length + treeStats.margin * 2\n\n            // fill box\n            if (x + boxWidth > canvas.width) {\n              x -= boxWidth\n            }\n            if (y + boxHeight > canvas.height) {\n              y -= boxHeight\n            }\n            ctx.fillStyle = \"rgba(240, 240, 240, 0.9)\"\n            ctx.fillRect(x, y, boxWidth, boxHeight)\n\n            // fill text\n            ctx.fillStyle = \"rgb(0, 0, 0)\"\n            for (let i = 0; i < windowText.length; i++) {\n              ctx.fillText(windowText[i], x + treeStats.margin, y + treeStats.margin + i * lineHeight)\n            }\n            ctx.restore()\n          } else {\n            leaf.highlighted = false\n          }\n          ctx.restore()\n        }\n      }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    delegate.apply(this, args);\n    addListeners.apply(this)\n    let ctx = this.canvas\n    this.addListener('mousemove', (e) => {\n      if (this.treeStats.debug) {\n      let path = new Path2D()\n      path.moveTo(0, 0)\n      path.lineTo(e.offsetX * getPixelRatio(ctx), e.offsetY * getPixelRatio(ctx))\n      path.closePath()\n      ctx.stroke(path)\n      }\n    })\n\n  });\n}\n"]},"metadata":{},"sourceType":"module"}