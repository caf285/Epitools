{"ast":null,"code":"import _slicedToArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { Tree, utils } from 'phylocanvas';\nvar getPixelRatio = utils.canvas.getPixelRatio;\nvar DEFAULTS = {\n  active: true,\n  width: 100,\n  height: 20,\n  fillStyle: 'black',\n  strokeStyle: 'black',\n  lineWidth: 1,\n  fontFamily: 'Sans-serif',\n  fontSize: 16,\n  textBaseline: 'bottom',\n  textAlign: 'center',\n  digits: 2,\n  position: {\n    bottom: 10,\n    left: 10\n  }\n};\nvar INVALID_HORIZONTAL_POSITION = 'Invalid horizontal position specified' + 'Supported values are `left`, `centre`, or `right`';\nvar INVALID_VERTICAL_POSITION = 'Invalid vertical position specified' + 'Supported values are `top`, `middle`, or `bottom`';\nvar LOG10 = Math.log(10);\n\nfunction drawScalebar() {\n  var scalebar = this.scalebar,\n      zoom = this.zoom,\n      branchScalar = this.branchScalar;\n  var position = scalebar.position;\n  var cxt = this.canvas;\n  var canvas = cxt.canvas;\n  var pixelRatio = getPixelRatio(cxt);\n  var width = pixelRatio * scalebar.width;\n  var height = pixelRatio * scalebar.height;\n  var lineWidth = pixelRatio * scalebar.lineWidth;\n  var fontSize = pixelRatio * scalebar.fontSize;\n  cxt.save();\n  var x = 0;\n\n  if (typeof position.left !== 'undefined') {\n    x = scalebar.lineWidth + position.left;\n  } else if (typeof position.centre !== 'undefined') {\n    x = canvas.width / 2 - width / 2 + position.centre;\n  } else if (typeof position.right !== 'undefined') {\n    x = canvas.width - width - scalebar.lineWidth - position.right;\n  } else {\n    this.loadError(INVALID_HORIZONTAL_POSITION);\n  }\n\n  var y = 0;\n\n  if (typeof position.top !== 'undefined') {\n    y = position.top;\n  } else if (typeof position.middle !== 'undefined') {\n    y = canvas.height / 2 - height + position.middle;\n  } else if (typeof position.bottom !== 'undefined') {\n    y = canvas.height - height - position.bottom;\n  } else {\n    this.loadError(INVALID_VERTICAL_POSITION);\n  }\n\n  cxt.clearRect(x, y, width, height);\n  cxt.font = \"\".concat(fontSize, \"px \").concat(scalebar.fontFamily);\n  cxt.fillStyle = scalebar.fillStyle;\n  cxt.strokeStyle = scalebar.strokeStyle;\n  cxt.lineWidth = lineWidth * pixelRatio / 2;\n  cxt.textBaseline = scalebar.textBaseline;\n  cxt.textAlign = scalebar.textAlign;\n  cxt.beginPath();\n  cxt.moveTo(x, y);\n  cxt.lineTo(x + width, y);\n  cxt.stroke();\n  cxt.moveTo(x, y);\n  cxt.lineTo(x, y + height);\n  cxt.stroke();\n  cxt.moveTo(x + width, y);\n  cxt.lineTo(x + width, y + height);\n  cxt.stroke();\n  cxt.closePath();\n  var scale = width / branchScalar / zoom;\n  var minDigitis = parseInt(Math.abs(Math.log(scale) / LOG10), 10);\n  var label = scale.toFixed(minDigitis + scalebar.digits);\n  cxt.fillText(label, x + width / 2, y + height);\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', function (delegate, args) {\n    var tree = delegate.apply(void 0, _toConsumableArray(args));\n\n    var _args = _slicedToArray(args, 2),\n        _args$ = _args[1],\n        config = _args$ === void 0 ? {} : _args$;\n\n    tree.scalebar = Object.assign({}, DEFAULTS, config.scalebar || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n\n    if (this.scalebar.active) {\n      drawScalebar.apply(this);\n    }\n  });\n}","map":{"version":3,"sources":["/var/www/pathogen-intelligence.tgen.org/epitools/my_modules/phylocanvas-plugin-scalebar/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","width","height","fillStyle","strokeStyle","lineWidth","fontFamily","fontSize","textBaseline","textAlign","digits","position","bottom","left","INVALID_HORIZONTAL_POSITION","INVALID_VERTICAL_POSITION","LOG10","Math","log","drawScalebar","scalebar","zoom","branchScalar","cxt","pixelRatio","save","x","centre","right","loadError","y","top","middle","clearRect","font","beginPath","moveTo","lineTo","stroke","closePath","scale","minDigitis","parseInt","abs","label","toFixed","fillText","restore","plugin","decorate","delegate","args","tree","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n  width: 100,\n  height: 20,\n  fillStyle: 'black',\n  strokeStyle: 'black',\n  lineWidth: 1,\n  fontFamily: 'Sans-serif',\n  fontSize: 16,\n  textBaseline: 'bottom',\n  textAlign: 'center',\n  digits: 2,\n  position: {\n    bottom: 10,\n    left: 10,\n  },\n};\n\nconst INVALID_HORIZONTAL_POSITION = 'Invalid horizontal position specified' +\n  'Supported values are `left`, `centre`, or `right`';\nconst INVALID_VERTICAL_POSITION = 'Invalid vertical position specified' +\n  'Supported values are `top`, `middle`, or `bottom`';\n\nconst LOG10 = Math.log(10);\n\nfunction drawScalebar() {\n  const { scalebar, zoom, branchScalar } = this;\n  const { position } = scalebar;\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const width = pixelRatio * scalebar.width;\n  const height = pixelRatio * scalebar.height;\n  const lineWidth = pixelRatio * scalebar.lineWidth;\n  const fontSize = pixelRatio * scalebar.fontSize;\n\n  cxt.save();\n\n  let x = 0;\n  if (typeof position.left !== 'undefined') {\n    x = scalebar.lineWidth + position.left;\n  } else if (typeof position.centre !== 'undefined') {\n    x = (canvas.width / 2) - (width / 2) + position.centre;\n  } else if (typeof position.right !== 'undefined') {\n    x = canvas.width - width - scalebar.lineWidth - position.right;\n  } else {\n    this.loadError(INVALID_HORIZONTAL_POSITION);\n  }\n  let y = 0;\n  if (typeof position.top !== 'undefined') {\n    y = position.top;\n  } else if (typeof position.middle !== 'undefined') {\n    y = (canvas.height / 2) - height + position.middle;\n  } else if (typeof position.bottom !== 'undefined') {\n    y = canvas.height - height - position.bottom;\n  } else {\n    this.loadError(INVALID_VERTICAL_POSITION);\n  }\n  cxt.clearRect(x, y, width, height);\n\n  cxt.font = `${fontSize}px ${scalebar.fontFamily}`;\n  cxt.fillStyle = scalebar.fillStyle;\n  cxt.strokeStyle = scalebar.strokeStyle;\n  cxt.lineWidth = lineWidth * pixelRatio / 2;\n  cxt.textBaseline = scalebar.textBaseline;\n  cxt.textAlign = scalebar.textAlign;\n\n  cxt.beginPath();\n  cxt.moveTo(x, y);\n  cxt.lineTo(x + width, y);\n  cxt.stroke();\n  cxt.moveTo(x, y);\n  cxt.lineTo(x, y + height);\n  cxt.stroke();\n  cxt.moveTo(x + width, y);\n  cxt.lineTo(x + width, y + height);\n  cxt.stroke();\n  cxt.closePath();\n\n  const scale = width / branchScalar / zoom;\n  const minDigitis = parseInt(Math.abs(Math.log(scale) / LOG10), 10);\n  const label = scale.toFixed(minDigitis + scalebar.digits);\n  cxt.fillText(label, x + width / 2, y + height);\n\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.scalebar = Object.assign({}, DEFAULTS, config.scalebar || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n    if (this.scalebar.active) {\n      drawScalebar.apply(this);\n    }\n  });\n}\n"]},"metadata":{},"sourceType":"module"}