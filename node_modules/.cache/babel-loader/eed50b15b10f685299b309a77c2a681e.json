{"ast":null,"code":"import _slicedToArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _createForOfIteratorHelper from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";\nimport { Tree, utils } from 'phylocanvas';\nvar getPixelRatio = utils.canvas.getPixelRatio;\nvar DEFAULTS = {\n  active: true\n};\n\nfunction addListeners() {\n  var _this = this;\n\n  var tree = this;\n  var ctx = this.canvas;\n  var canvas = ctx.canvas;\n  var pixelRatio = getPixelRatio(ctx);\n  var textSize = this.textSize;\n\n  if (this.treeStats.active) {\n    //cleanup old event listeners\n    var _iterator = _createForOfIteratorHelper(this.eventListeners.mousemove.filter(function (eventListener) {\n      return eventListener.listener.name == \"treeStats\";\n    })),\n        _step;\n\n    try {\n      for (_iterator.s(); !(_step = _iterator.n()).done;) {\n        var eventListener = _step.value;\n        this.removeListener('mousemove', eventListener.listener, canvas);\n      }\n    } catch (err) {\n      _iterator.e(err);\n    } finally {\n      _iterator.f();\n    }\n\n    console.log(this);\n\n    var _iterator2 = _createForOfIteratorHelper(this.leaves),\n        _step2;\n\n    try {\n      var _loop = function _loop() {\n        var leaf = _step2.value;\n\n        _this.addListener('mousemove', treeStats, canvas);\n\n        function treeStats(e) {\n          var path = new Path2D();\n          var x = (tree.offsetx - tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom / pixelRatio + leaf.maxx * tree.zoom / pixelRatio) * pixelRatio;\n          var y = (tree.offsety + leaf.maxy * tree.zoom / pixelRatio) * pixelRatio;\n          ctx.save();\n          ctx.font = \"\".concat(textSize * pixelRatio * 2, \"px \").concat(this.font);\n          var width = ctx.measureText(leaf.label).width * pixelRatio * tree.zoom / tree.zoomFactor;\n          ctx.restore();\n          var height = ctx.measureText(\"M\").width * pixelRatio * tree.zoom / tree.zoomFactor;\n          path.moveTo(x, y);\n          path.lineTo(x + width, y);\n          path.lineTo(x + width, y - height);\n          path.lineTo(x, y - height);\n          path.lineTo(x, y);\n          path.closePath();\n          ctx.stroke(path);\n\n          if (ctx.isPointInPath(path, e.offsetX * pixelRatio, e.offsetY * pixelRatio)) {\n            leaf.highlighted = true;\n            console.log(leaf);\n          } else {\n            leaf.highlighted = false;\n          }\n        }\n      };\n\n      for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {\n        _loop();\n      }\n    } catch (err) {\n      _iterator2.e(err);\n    } finally {\n      _iterator2.f();\n    }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', function (delegate, args) {\n    var tree = delegate.apply(void 0, _toConsumableArray(args));\n\n    var _args = _slicedToArray(args, 2),\n        _args$ = _args[1],\n        config = _args$ === void 0 ? {} : _args$;\n\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    delegate.apply(this, args);\n    addListeners.apply(this);\n    var ctx = this.canvas;\n    this.addListener('mousemove', function (e) {\n      var path = new Path2D();\n      path.moveTo(0, 0);\n      path.lineTo(e.offsetX * getPixelRatio(ctx), e.offsetY * getPixelRatio(ctx));\n      path.closePath();\n      ctx.stroke(path);\n    });\n  });\n}","map":{"version":3,"sources":["/var/www/pathogen-intelligence.tgen.org/epitools/my_modules/phylocanvas-plugin-tree-stats/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","addListeners","tree","ctx","pixelRatio","textSize","treeStats","eventListeners","mousemove","filter","eventListener","listener","name","removeListener","console","log","leaves","leaf","addListener","e","path","Path2D","x","offsetx","baseNodeSize","zoom","getLabelStartX","maxx","y","offsety","maxy","save","font","width","measureText","label","zoomFactor","restore","height","moveTo","lineTo","closePath","stroke","isPointInPath","offsetX","offsetY","highlighted","plugin","decorate","delegate","args","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n};\n\nfunction addListeners() {\n  const tree = this\n  const ctx = this.canvas;\n  const canvas = ctx.canvas;\n  const pixelRatio = getPixelRatio(ctx);\n  const textSize = this.textSize\n  if (this.treeStats.active) {\n      //cleanup old event listeners\n      for (let eventListener of this.eventListeners.mousemove.filter(eventListener => eventListener.listener.name == \"treeStats\")) {\n        this.removeListener('mousemove', eventListener.listener, canvas)\n      }\n      console.log(this)\n      for (let leaf of this.leaves) {\n        this.addListener('mousemove', treeStats, canvas)\n        function treeStats(e) {\n          let path = new Path2D()\n          let x = (tree.offsetx - tree.baseNodeSize * tree.zoom + leaf.getLabelStartX() * tree.zoom / pixelRatio + leaf.maxx * tree.zoom / pixelRatio) * pixelRatio\n          let y = (tree.offsety + leaf.maxy * tree.zoom / pixelRatio) * pixelRatio\n          ctx.save()\n          ctx.font = `${textSize * pixelRatio * 2}px ${this.font}`;\n          let width = ctx.measureText(leaf.label).width * pixelRatio * tree.zoom / tree.zoomFactor\n          ctx.restore()\n          let height = ctx.measureText(\"M\").width * pixelRatio * tree.zoom / tree.zoomFactor\n          path.moveTo(x, y)\n          path.lineTo(x + width, y)\n          path.lineTo(x + width, y - height)\n          path.lineTo(x, y - height)\n          path.lineTo(x, y)\n          path.closePath()\n          ctx.stroke(path)\n          if (ctx.isPointInPath(path, e.offsetX * pixelRatio, e.offsetY * pixelRatio)) {\n            leaf.highlighted = true\n            console.log(leaf)\n          } else {\n            leaf.highlighted = false\n          }\n        }\n      }\n  }\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.treeStats = Object.assign({}, DEFAULTS, config.treeStats || {});\n    return tree;\n  });\n  decorate(Tree, 'load', function (delegate, args) {\n    delegate.apply(this, args);\n    addListeners.apply(this)\n    let ctx = this.canvas\n    this.addListener('mousemove', (e) => {\n      let path = new Path2D()\n      path.moveTo(0, 0)\n      path.lineTo(e.offsetX * getPixelRatio(ctx), e.offsetY * getPixelRatio(ctx))\n      path.closePath()\n      ctx.stroke(path)\n    })\n\n  });\n}\n"]},"metadata":{},"sourceType":"module"}