{"ast":null,"code":"import _slicedToArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"/var/www/pathogen-intelligence.tgen.org/epitools/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { Tree, utils } from 'phylocanvas';\nvar getPixelRatio = utils.canvas.getPixelRatio;\nvar DEFAULTS = {\n  active: true\n};\n\nfunction drawBranchLength() {\n  var branchLength = this.branchLength;\n  var cxt = this.canvas;\n  var canvas = cxt.canvas;\n  var pixelRatio = getPixelRatio(cxt);\n  var pi = 3.141592653589793;\n  var textSize = this.textSize * this.zoom / 2;\n  cxt.save();\n  cxt.font = \"\".concat(textSize * pixelRatio, \"px \").concat(this.font);\n  cxt.fillStyle = this.branchColour;\n  cxt.textBaseline = \"bottom\";\n  cxt.textAlign = \"center\";\n\n  for (var branch in this.branches) {\n    if (this.branches[branch].branchLength == 0) {\n      continue;\n    }\n\n    branch = this.branches[branch];\n    var x = (this.offsetx + (branch.startx + (branch.centerx - branch.startx) / 2) * this.zoom / 2) * pixelRatio;\n    var y = (this.offsety + (branch.starty + (branch.centery - branch.starty) / 2) * this.zoom / 2) * pixelRatio;\n\n    if (this.treeType == \"rectangular\") {\n      y = (this.offsety + branch.centery * this.zoom / 2) * pixelRatio;\n    } else if (pi * 1 / 4 < branch.angle && branch.angle < pi * 3 / 4 || pi + pi * 1 / 4 < branch.angle && branch.angle < pi + pi * 3 / 4) {\n      x = (this.offsetx + textSize + branch.centerx * this.zoom / 2) * pixelRatio;\n      y += textSize * pixelRatio;\n    }\n\n    cxt.fillText(branch.branchLength, x, y);\n  }\n\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', function (delegate, args) {\n    var tree = delegate.apply(void 0, _toConsumableArray(args));\n\n    var _args = _slicedToArray(args, 2),\n        _args$ = _args[1],\n        config = _args$ === void 0 ? {} : _args$;\n\n    tree.branchLength = Object.assign({}, DEFAULTS, config.branchLength || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n\n    if (this.branchLength.active) {\n      drawBranchLength.apply(this);\n    }\n  });\n}","map":{"version":3,"sources":["/var/www/pathogen-intelligence.tgen.org/epitools/my_modules/phylocanvas-plugin-branch-length/index.js"],"names":["Tree","utils","getPixelRatio","canvas","DEFAULTS","active","drawBranchLength","branchLength","cxt","pixelRatio","pi","textSize","zoom","save","font","fillStyle","branchColour","textBaseline","textAlign","branch","branches","x","offsetx","startx","centerx","y","offsety","starty","centery","treeType","angle","fillText","restore","plugin","decorate","delegate","args","tree","config","Object","assign","apply"],"mappings":"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","sourcesContent":["import { Tree, utils } from 'phylocanvas';\n\nconst { getPixelRatio } = utils.canvas;\n\nconst DEFAULTS = {\n  active: true,\n};\n\nfunction drawBranchLength() {\n\n  const { branchLength } = this;\n  const cxt = this.canvas;\n  const canvas = cxt.canvas;\n  const pixelRatio = getPixelRatio(cxt);\n  const pi = 3.141592653589793\n  const textSize = this.textSize * this.zoom / 2\n\n  cxt.save();\n\n  cxt.font = `${textSize * pixelRatio}px ${this.font}`;\n  cxt.fillStyle = this.branchColour;\n  cxt.textBaseline = \"bottom\";\n  cxt.textAlign = \"center\";\n\n  for (let branch in this.branches) {\n    if (this.branches[branch].branchLength == 0) {\n      continue\n    }\n    branch = this.branches[branch]\n    let x = (this.offsetx + (branch.startx + (branch.centerx - branch.startx) / 2) * this.zoom / 2) * pixelRatio\n    let y = (this.offsety + (branch.starty + (branch.centery - branch.starty) / 2) * this.zoom / 2) * pixelRatio\n    if (this.treeType == \"rectangular\") {\n      y = (this.offsety + branch.centery * this.zoom / 2) * pixelRatio\n    } else if (pi * 1 / 4 < branch.angle && branch.angle < pi * 3 / 4 || pi + pi * 1 / 4 < branch.angle && branch.angle < pi + pi * 3 / 4) {\n      x = (this.offsetx + textSize + branch.centerx * this.zoom / 2) * pixelRatio\n      y += textSize * pixelRatio\n    }\n    cxt.fillText(branch.branchLength, x, y)\n  }\n\n  cxt.restore();\n}\n\nexport default function plugin(decorate) {\n  decorate(this, 'createTree', (delegate, args) => {\n    const tree = delegate(...args);\n    const [ , config = {} ] = args;\n    tree.branchLength = Object.assign({}, DEFAULTS, config.branchLength || {});\n    return tree;\n  });\n  decorate(Tree, 'draw', function (delegate, args) {\n    delegate.apply(this, args);\n    if (this.branchLength.active) {\n      drawBranchLength.apply(this);\n    }\n  });\n}\n"]},"metadata":{},"sourceType":"module"}