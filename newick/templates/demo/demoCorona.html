{% extends "newick/samples.html" %}

{% block static %}
  {{ block.super }}
  {% load leaflet_tags %}
  {% leaflet_css %}
  {% leaflet_js %}
  {% load static %}

  
  <script src="{% static '/leaflet/leaflet-heat.js' %}"></script>
  <script src="{% static '/leaflet/leaflet-svgicon/svg-icon.js' %}"></script>
  <script src="{% static '/newick/js/zipAvg.js'%}"></script>
  <script src="{% static '/newick/js/zipCoordinates.js'%}"></script>
  <style>
    .leaflet-container {  /* all maps */
      width: 100%;
      height: 100%;
      z-index: 1;
    }   
  </style>


  <!--====================================================================================================( SCRIPTS )-->
  <script>
    //=========================( Wait For Page Load )
    document.onreadystatechange = function () {
      if (document.readyState === 'complete') {
        // option button
        document.getElementsByClassName('biomod-options-icon')[0].addEventListener('click', function() {
          document.getElementsByClassName('biomod-options')[0].classList.toggle('tog');
          window.dispatchEvent(new Event('resize'));
        })
        window.dispatchEvent(new Event('resize'));
      }
    }
  </script>

{% endblock %}

{% block BioMod %}

  <div class="biomod biomod-container">
    <!--====================================================================================================( OPTIONS MENU )-->
    <div class="biomod biomod-options">
      Display Area for Dropdown Menues.
    </div>

    <!--====================================================================================================( MAIN CONTENT )-->
    <div class="biomod biomod-content">
      <div class="biomod biomod-row">
        <div class="biomod biomod-options-icon"><img src="{% static '/newick/images/options.png' %}"></div>
        <div class="biomod biomod-module" style="flex-grow: 5;">

  {% leaflet_map "main" %}


  <script>
    window.addEventListener("map:init", function (e) {
      var detail = e.detail;

      //----- add grey and dark heat layers to map
      var baseLayers = {
        "Grey" : L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}', {'attribution': 'Esri &mdash; Esri, DeLorme, NAVTEQ', 'maxZoom': 16}),
        "Dark Grey" : L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}', {'attribution': 'Esri &mdash; Esri, DeLorme, NAVTEQ', 'maxZoom': 16}),
      };
      L.control.layers(baseLayers, null).addTo(detail.map);

      //----- add all zipAvg to heat map
      let heatList = []
      for (let zipCode of Object.values(zipAvg)) {
        heatList.push([zipCode["lat"], zipCode["long"], 20])
      }
      var heatLayers = {
        "Heat": L.heatLayer(heatList, {radius: 50, blur: 5})
      }
      L.control.layers(null, heatLayers).addTo(detail.map);

      //----- add polygons to map
      var zipCodeLayers = {}
      for (let zipCode of Object.keys(zipPolygons)) {
        zipCodeLayers[zipCode] = L.polygon(zipPolygons[zipCode]["poly"], {
          title: zipCode,
          clickable: false,
          color: 'hsl(0, 100%, 0%)',
          opacity: 0.7,
          weight: 1,
          fillOpacity: 0.0
        })
        detail.map.addLayer(zipCodeLayers[zipCode])
      }
      L.control.layers(null, zipCodeLayers).addTo(detail.map);






/*
      // Banner Baywood Medical Center
      var marker = L.marker([33.410604, -111.68806],{title:"Banner Baywood Medical Center",clickable:true}).addTo(detail.map);

      // Banner Boswell Medical Center
      var marker = L.marker([33.603941, -112.28356],{title:"Banner Boswell Medical Center",clickable:true}).addTo(detail.map); //emm82, 18

*/
      // --------------------( TILE LAYERS & OVERLAYS )

        /*var polygon = L.polygon(counties[Object.keys(counties).sort()[i]], {
          title: Object.keys(counties).sort()[i],
          clickable: true,
          color: 'hsl(0, 100%, 0%)',
          opacity: 0.7,
          weight: 1,
          fillOpacity: 0.0
        });
        overlays[Object.keys(counties).sort()[i]] = polygon;
        detail.map.addLayer(polygon)*/
      //L.control.layers(baseLayers, overlays).addTo(detail.map);

      detail.map.addLayer(baseLayers["Grey"])
    }, false);


  </script>
        </div>
        <div class="biomod biomod-module" style="flex-grow: 0;;">
          Display Area for Additional Corona Virus Stats.
        </div>
      </div>
    </div>
  </div>

{% endblock %}
